!function(e){e.fn.aSendForm=function(a){e(this).each(function(){function o(e,a){var o={};for(var n in e)o[n]=e[n];for(var n in a)o[n]=a[n];return o}var n=e.extend({answer:!1,popup:!1,popupEvent:!1,popupObj:{},onClickPopup:!1,onClickForm:!1,goal:!1,postQuery:"/handle.php",closeData:1e3,dataClass:"amassage_popup",associations:null,onSend:!1,moreData:!1,bitrix:{TITLE:!1},validateRuls:!1,phoneValid:!1},a),t=e(this);if("function"==typeof n.popupObj.onClose){var i=n.popupObj.onClose;n.popupObj.onClose=function(){i(),"function"==typeof e.aCallBack&&setTimeout(function(){e.aCallBack("tada")},3e4)}}else n.popupObj.onClose=function(){"function"==typeof e.aCallBack&&setTimeout(function(){e.aCallBack("tada")},3e4)};n.popup&&("function"==typeof e.fn.bPopup?("undefined"!=typeof n.popup[1]&&e(n.popup[1]).bind("click",function(){return"function"==typeof n.onClickPopup&&n.onClickPopup.apply(this),e(n.popup[0]).bPopup(n.popupObj),!1}),n.popupEvent&&e(document).on(n.popupEvent,function(a,o){e(n.popup[0]).bPopup(n.popupObj)})):(n.popup=!1,console.warn("Plugin bPopup is not defined, popups is not work")));var s=!1;if(n.phoneValid&&("function"==typeof e.fn.mask?(t.find("[name="+n.phoneValid[0]+"]").mask("+00",{placeholder:"+1"}),t.find("[name="+n.phoneValid[1]+"]").mask("000",{placeholder:"123"}),t.find("[name="+n.phoneValid[2]+"]").mask("0000000",{placeholder:"1234567"}),n.phoneValid[3]&&(s={},s.rules={},s.messages={},s.rules[n.phoneValid[0]]={required:!0,minlength:2},s.rules[n.phoneValid[1]]={required:!0,minlength:3},s.rules[n.phoneValid[2]]={required:!0,minlength:7},s.messages[n.phoneValid[0]]={required:" ",minlength:" "},s.messages[n.phoneValid[1]]={required:" ",minlength:" "},s.messages[n.phoneValid[2]]={required:" ",minlength:" "})):console.warn("Function nask is not defined, nask is not work")),n.validateRuls)if("function"==typeof e.fn.validate){var p={errorElement:"div",errorPlacement:function(a,o){e(o).css("box-shadow","0 0 5px #ED2328"),e(o).css("border-color","#ED2328")," "!=e(a[0]).text()&&(e(o).after(e(a).addClass("a-valid-message").css("margin-top",14-e(o).css("marginBottom").replace(/px/g,"")+"px").css("width",e(o).next(".a-valid-message > p").outerWidth()+"px").css("margin-left",e(o).outerWidth()/100*70+parseFloat(e(o).css("marginLeft"))+"px").css("display","none").fadeIn("fast",function(){setTimeout(function(){e(o).next(".a-valid-message").fadeOut(60)},2e3)})),"none"!=e(o).css("float")&&e(o).next(".a-valid-message").css("margin-top",14+parseFloat(e(o).height())+"px"),e(o).focus(function(){e(o).next(".a-valid-message").fadeIn("fast")}),e(o).focusout(function(){e(o).next(".a-valid-message").fadeOut(50)}))},success:function(e){e.prev("input").css({"box-shadow":"","border-color":""}),e.remove()}};e.validator.addMethod("regex",function(e,a,o){var n=new RegExp(o);return this.optional(a)||n.test(e)},"Please check your input."),n.phoneValid[3]&&(n.validateRuls.rules=o(s.rules,n.validateRuls.rules),n.validateRuls.messages=o(s.messages,n.validateRuls.messages)),t.validate(o(p,n.validateRuls)),t.find("input").keypress(function(e){return 13==e.which?(t.validate().form()&&t.submit(),!1):void 0})}else console.warn("Function validate is not defined, validation is not work");t.bind("submit",function(){if("function"==typeof e.fn.validate&&!t.validate().form())return!1;var a={};if(n.onClickForm){var o=n.onClickForm.apply(this);if(o)for(var i=0;i<o.length;i++)a["artsDataD"+i]=[o[i].title,o[i].data]}for(var s=e(this).serializeArray(),i=0;i<s.length;i++)n.associations[s[i].name]?a[s[i].name]=[n.associations[s[i].name],s[i].value]:a[s[i].name]=[s[i].name,s[i].value];if(n.phoneValid&&(n.associations.phone?a.phone=[n.associations.phone,a[n.phoneValid[0]][1]+a[n.phoneValid[1]][1]+a[n.phoneValid[2]][1]]:a.phone=["phone",a[n.phoneValid[0]][1]+a[n.phoneValid[1]][1]+a[n.phoneValid[2]][1]],delete a[n.phoneValid[0]],delete a[n.phoneValid[1]],delete a[n.phoneValid[2]]),e(this).find("input, textarea").each(function(){"submit"!=e(this).attr("type")&&e(this).val("")}),"function"==typeof n.goal&&n.goal.apply(this),a.art_post_pagetitle=document.title,n.bitrix.TITLE){a.art_bitrix=[];for(var p in n.bitrix)a[n.bitrix[p]]?a.art_bitrix.push([p,a[n.bitrix[p]][1]]):a.art_bitrix.push([p,n.bitrix[p]])}if(n.moreData)for(var i=0;i<n.moreData.length;i++)a["artsDataF"+i]=[n.moreData[i].title,n.moreData[i].data];return e.post(n.postQuery,a).done(function(a){n.popup&&e(n.popup[0]).bPopup().close(),"function"==typeof n.onSend&&n.onSend(),n.answer&&(a=n.answer),"object"!=typeof n.answer?(e("body").append('<div class="amassage_popup"><div class="bgPopUp"></div><div class="content"><h2>'+a+'</h2></div><div class="b-close"></div></div>'),e("."+n.dataClass).bPopup({autoClose:n.closeData,onClose:function(){e("."+n.dataClass).remove()},follow:[!1,!0],position:["50%","auto"]})):n.answer.bPopup({autoClose:n.closeData,onClose:function(){e("."+n.dataClass).remove()}})}),!1})})}}(jQuery);